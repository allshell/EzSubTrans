# EzSubTrans v0.4

EzSubTrans是一款用户友好的图形界面工具，旨在利用大型语言模型（LLM）的强大能力，快速、便捷地翻译`.srt`和`.ass`格式的字幕文件。

## 主要特性

* **支持多种格式**: 可加载和保存`.ass`和`.srt`字幕文件。

* **LLM 驱动翻译**: 通过接入兼容 OpenAI API 标准的大语言模型（如 OpenAI 的 GPT 系列、或其他云服务/本地部署模型）进行翻译。

* **窗口化处理**: 将字幕分割成可配置大小的批次进行翻译，大幅优化因字幕断句造成的语义断裂，提高效率，并管理 API 请求。

* **灵活配置**:
    * **API 配置**: 支持自定义 `API Base URL`、`API Key` 和 `Model Name`，兼容多种 LLM 服务提供商。
    * **翻译参数**: 可调整每次请求的行数（窗口大小）、模型温度（控制创造性）和失败重试次数。
    * **语言指定**: 明确设置多种源语言和目标语言。

* **上下文感知**:
    * **背景描述**: （可选）提供简短的文本描述（如“科幻电影”、“烹饪教程”）以指导翻译方向。
    * **深度理解 (v0.4 新增)**: （可选）在翻译前，让 LLM 预先分析和总结整个字幕内容，生成更丰富的上下文信息，从而可能获得更准确、更连贯的翻译结果。启用此功能会替代“背景描述”。

* **用户友好**:
    * **图形界面 (GUI)**: 直观的操作界面，无需命令行知识。
    * **API 测试 (v0.4 新增)**: 内置按钮一键测试 API 配置的有效性。
    * **高 DPI 兼容 (v0.4 优化)**: 改善了在不同屏幕缩放设置下的界面显示效果。
    * **自动命名**: 如果未指定输出文件，会自动根据输入文件名和目标语言生成。
    * **进度显示**: 提供实时翻译进度、状态信息和预计剩余时间 (ETA)。
    * **中断操作**: 可以随时中止正在进行的翻译任务，并自动保存已完成的结果。

* **配置持久化**: API 和部分设置会自动保存到本地`config.json`文件中，方便下次使用。

## 如何使用

1. **用户**: [下载](https://github.com/allshell/EzSubTrans/releases/download/v0.4/EzSubTrans_v0.4.exe)并直接双击运行 EzSubTrans_v0.4.exe，无需安装或配置 Python 环境。跳转到第3步。

2. **开发者**:
   * 在 Python 环境中（Python 3.11.5 已测试，不保证其余版本可用性）安装所需库：
     ```bash
     pip install openai pysubs2
     ```
   * 运行 `src` 文件夹中的 `gui.py` 文件：
     ```bash
     python gui.py
     ```
3. **配置 API**:
    * 在 GUI 的 "API 配置" 区域填入你的服务信息：
        * **API Base URL**: 你的 LLM 服务提供商的 API 端点。对于 OpenAI 官方，通常是 `https://api.openai.com/v1`。对于其他服务或本地模型，请查阅其文档。
        * **API Key**: 你的 API 服务凭证。
        * **Model Name**: 你希望使用的具体模型名称 (例如 `gpt-4o-mini`, `deepseek-chat`)。
    * **（重要）测试配置**: 点击 "测试配置" 按钮，确保程序可以成功连接到 API 并验证模型名称。
    * **注意**: API Key 会以明文形式存储在程序目录下的 `config.json` 文件中。请妥善保管此文件，不要泄露给他人！
4. **选择文件**:
    * 点击 "浏览..." 选择要翻译的输入字幕文件 (`.srt` 或 `.ass`)。
    * （可选）点击 "另存为..." 指定翻译结果的保存路径和文件名。若不指定，程序会自动生成。
5. **调整选项**:
    * **窗口大小**: 每次 API 调用处理的行数。
    * **温度**: 控制模型输出的随机性/创造性。
    * **最大重试**: 单个批次翻译失败时的重试次数。
    * **源语言/目标语言**: 准确填写字幕的原始语言和期望翻译成的语言（例如 `英语`, `简体中文`, `日语`）。
    * **背景描述 / 深度理解**: 根据需要填写背景描述，或勾选“启用深度理解”让程序自动分析上下文（注意：深度理解会额外消耗 API Token）。
6. **开始翻译**: 点击 "开始翻译" 按钮。进度条、状态信息和预计剩余时间将实时更新。
7. **中断翻译**: 如果需要，可以点击 "终止翻译" 按钮停止任务。程序会尝试将部分已完成的翻译结果保存为 `_partial` 文件。
8. **完成**: 翻译完成后，状态栏会提示，并在指定路径生成翻译好的字幕文件。

## 注意事项

* **API 成本**: 使用 LLM API 通常需要付费。请注意你的 API 提供商的定价策略和你的使用量。启用“深度理解”功能会增加额外的 API 调用成本。
* **翻译质量**: 翻译质量依赖于所选 LLM 的能力、提示词的精确性以及原文的清晰度。结果可能需要后期校对和润色。
* **错误处理**: 程序会尝试处理常见的 API 错误和行数不匹配问题，但复杂情况可能导致部分行翻译失败或保留原文。
* **ASS 字幕**: 不建议直接输入带有大量繁杂特效的 `.ass` 字幕文件（如使用大量自动化行实现的卡拉OK特效），可能导致翻译失败或超出预期的 API Token 消耗。
